module game_data(
    input clk_mem,
    input [ 31: 0 ] clkdiv,
    input clk_vga,
    input rst_n,
    input clear,
    input vga_en,
    input [ 10: 0 ] vgaH,
    input [ 10: 0 ] vgaV,
    input [ 7: 0] key_status,
    input [ 2: 0] speed,
    output reg [ 11: 0 ] vgaData,
    output reg [ 3: 0 ] ironManCounter,
    output reg [ 3: 0 ] fireManCounter,
    output status
    );
    wire [11:0] walldata;
    wire [11:0] firedata;
    wire [11:0] clouddata;
    wire [11:0] enemydata;
    wire [11:0] ironMandata;
    wire [11:0] exitdata;
    wire [11:0] fireMandata;
    wire [11:0] ironManWindata;
    wire [11:0] fireManWindata;
    assign fireManWindata = (vgaH >= 159 && vgaH <=479 && vgaV >= 119 && vgaV <=359) ?
                            (font[76799 - (vgaH- 159 + 320 * (vgaV - 119))]? 12'h000: 12'hfff):
                            12'hfff;
    wire [11:0] notBegindata;

    reg [299:0] wall; //record the location of wall bricks
    reg [299:0] fire;  //record the location of fire 
    reg [299:0] cloud;  //record the location of clouds
    reg [299:0] enemy1; //record the location of enemy1 
    reg [299:0] enemy2; //record the location of enemy2
    reg [76799:0] font;
    reg signed [11:0] x1; //record the pixel location x of the top left corner of IronMan
    wire [10:0] x2;
    reg signed [11:0] y1; //record the pixel location y of the top left corner of IronMan
    wire [10:0] y2;
    assign x2 = x1 + 17;
    assign y2 = y1 + 26; //IronMan is 18*27

    reg signed [11:0] fx1; //record the pixel location x of the top left corner of IronMan
    wire [10:0] fx2;
    reg signed [11:0] fy1; //record the pixel location y of the top left corner of FireMan
    wire [10:0] fy2;
    assign fx2 = fx1 + 24;
    assign fy2 = fy1 + 24; //FireMan is 25*25

    wire [18:0] offsetX;
    wire [18:0] offsetY;
    assign offsetX = (vgaH >>  5);
    assign offsetY = (vgaV >>  5);

    wire [18:0] addr1;
    wire [8:0] addr2;
    wire [9:0] addr3;
    wire [9:0] addr4;
    assign addr1 = vgaV*640+vgaH;
    assign addr2 = (vgaV- y1) * 18 + vgaH - x1;           
    assign addr3 = (vgaV- fy1) * 25 + vgaH - fx1;
    assign addr4 = (vgaV- (offsetY << 5)) * 32 + vgaH - (offsetX<<5);

    wire[10:0] blockNum1; //record which block the top left corner of ironMan is in
    wire[10:0] blockNum2; //top right
    wire[10:0] blockNum3; //left bottom
    wire[10:0] blockNum4; //right bottom
    assign blockNum1 =  ( x1 >> 5 ) + ( y1 >> 5) * 20;
    assign blockNum2 =  ( x2 >> 5 ) + ( y1 >> 5) * 20;
    assign blockNum3 =  ( x1 >> 5 ) + ( y2 >> 5) * 20;
    assign blockNum4 =  ( x2 >> 5 ) + ( y2 >> 5) * 20;

    wire[10:0] fblockNum1; //record which block the top left corner of fireMan is in
    wire[10:0] fblockNum2; //top right
    wire[10:0] fblockNum3; //left bottom
    wire[10:0] fblockNum4; //right bottom
    assign fblockNum1 =  ( fx1 >> 5 ) + ( fy1 >> 5) * 20;
    assign fblockNum2 =  ( fx2 >> 5 ) + ( fy1 >> 5) * 20;
    assign fblockNum3 =  ( fx1 >> 5 ) + ( fy2 >> 5) * 20;
    assign fblockNum4 =  ( fx2 >> 5 ) + ( fy2 >> 5) * 20;

    assign catched = (x1-fx1)<= 24 && (x1-fx1)>=-17 && (y1-fy1)<= 26 && (y1-fy1)>=-24; 
    wire dead;
    assign dead = fire[blockNum1] || fire[blockNum2] || fire[blockNum3] || fire[blockNum4] 
               || enemy1[blockNum1] || enemy1[blockNum2] || enemy1[blockNum3] || enemy1[blockNum4]
               || enemy2[blockNum1] || enemy2[blockNum2] || enemy2[blockNum3] || enemy2[blockNum4] || catched;
    
    parameter  height = 11'd480;
    parameter  width  = 11'd640;
    //assign total = height * width;
    wire [10:0] exit; //end place
    assign exit = 11'd299;
    wire [10:0] selection;

    wire IsIronMan;
    wire IsFireMan;

    assign IsIronMan = (vgaH >= x1 && vgaH <= x2 && vgaV > y1 && vgaV <= y2);
    assign IsFireMan = (vgaH >= fx1 && vgaH <= fx2 && vgaV > fy1 && vgaV <= fy2);
    wire IsExit;
    wire IsWin;
    wire IsBegin;
    assign IsNotBegin = (x1 == 12'b0 && y1 == 12'b0 && fx1 == 12'd611 && fy1 == 12'b0); //move any character to begin the game
    assign IsExit = (offsetX == 19 && offsetY == 14);  
    assign IsWin = (blockNum1 == 11'd299) || ( blockNum2 == 11'd299) || ( blockNum3 == 11'd299) || ( blockNum4 == 11'd299) ;
    assign selection = {IsNotBegin,
                        dead,
                        IsWin,
                        IsFireMan && fireMandata != 12'hfff,
                        ~IsWin && IsExit,
                        IsIronMan && ironMandata != 12'hfff,
                        wall[offsetX+offsetY*20],
                        cloud[offsetX+offsetY*20],
                        fire[offsetX+offsetY*20],
                        enemy1[offsetX+offsetY*20],
                        enemy2[offsetX+offsetY*20]};

    always@(posedge clk_vga or negedge rst_n ) begin
        if(!rst_n) begin
            wall[4] <= 1'b1;wall[6] <= 1'b1;wall[17] <= 1'b1;wall[24] <= 1'b1;wall[26] <= 1'b1;wall[28] <= 1'b1;
            wall[29] <= 1'b1;wall[30] <= 1'b1;wall[31] <= 1'b1;wall[32] <= 1'b1;wall[33] <= 1'b1;wall[34] <= 1'b1;
            wall[35] <= 1'b1;wall[37] <= 1'b1;wall[39] <= 1'b1;wall[40] <= 1'b1;wall[41] <= 1'b1;wall[57] <= 1'b1;wall[59] <= 1'b1;
            wall[60] <= 1'b1;wall[61] <= 1'b1;wall[66] <= 1'b1; wall[68] <= 1'b1;wall[69] <= 1'b1;wall[72] <= 1'b1;
            wall[73] <= 1'b1;wall[74] <= 1'b1; wall[75] <= 1'b1;wall[79] <= 1'b1;wall[80] <= 1'b1;wall[81] <= 1'b1;
            wall[82] <= 1'b1; wall[83] <= 1'b1;wall[86] <= 1'b1;wall[88] <= 1'b1;wall[89] <= 1'b1;wall[92] <= 1'b1;
            wall[93] <= 1'b1;wall[94] <= 1'b1;wall[95] <= 1'b1;wall[97] <= 1'b1; wall[98] <= 1'b1;wall[99] <= 1'b1;
            wall[106] <= 1'b1;wall[108] <= 1'b1;wall[109] <= 1'b1;wall[120] <= 1'b1;wall[126] <= 1'b1;wall[127] <= 1'b1;wall[131] <= 1'b1;
            wall[132] <= 1'b1;wall[133] <= 1'b1;wall[135] <= 1'b1;wall[137] <= 1'b1;wall[139] <= 1'b1;wall[140] <= 1'b1;
            wall[142] <= 1'b1;wall[143] <= 1'b1;wall[144] <= 1'b1;wall[145] <= 1'b1;wall[146] <= 1'b1;wall[147] <= 1'b1;
            wall[148] <= 1'b1;wall[149] <= 1'b1;wall[151] <= 1'b1;wall[153] <= 1'b1; wall[155] <= 1'b1;wall[157] <= 1'b1;wall[159] <= 1'b1;
            wall[160] <= 1'b1;wall[164] <= 1'b1;wall[169] <= 1'b1;wall[171] <= 1'b1;wall[173] <= 1'b1; wall[177] <= 1'b1; wall[179] <= 1'b1;
            wall[180] <= 1'b1;wall[182] <= 1'b1;wall[183] <= 1'b1;wall[184] <= 1'b1;wall[193] <= 1'b1; wall[199] <= 1'b1;
            wall[200] <= 1'b1; wall[206] <= 1'b1;wall[207] <= 1'b1;wall[209] <= 1'b1; wall[211] <= 1'b1;wall[212] <= 1'b1;
            wall[213] <= 1'b1;wall[215] <= 1'b1;wall[217] <= 1'b1;wall[218] <= 1'b1;wall[219] <= 1'b1; wall[220] <= 1'b1;wall[221] <= 1'b1;wall[222] <= 1'b1;
            wall[223] <= 1'b1;wall[224] <= 1'b1;wall[226] <= 1'b1;wall[227] <= 1'b1; wall[229] <= 1'b1; wall[231] <= 1'b1;wall[233] <= 1'b1;
            wall[235] <= 1'b1;wall[240] <= 1'b1; wall[249] <= 1'b1;wall[255] <= 1'b1;wall[257] <= 1'b1;wall[258] <= 1'b1;
            wall[260] <= 1'b1;wall[262] <= 1'b1;wall[263] <= 1'b1;wall[264] <= 1'b1;wall[265] <= 1'b1;wall[266] <= 1'b1;
            wall[267] <= 1'b1;wall[268] <= 1'b1;wall[269] <= 1'b1;wall[271] <= 1'b1;wall[273] <= 1'b1; wall[275] <= 1'b1;
            wall[277] <= 1'b1; wall[278] <= 1'b1;wall[279] <= 1'b1; wall[280] <= 1'b1;wall[291] <= 1'b1;wall[295] <= 1'b1;
            fire[100] <= 1'b1;
            fire[154] <= 1'b1;
            fire[225] <= 1'b1;
            fire[253] <= 1'b1;
            cloud[141]<= 1'b1;
            cloud[205]<= 1'b1;
            cloud[230]<= 1'b1;
            cloud[256]<= 1'b1;
            font <= 76800'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007C000000000000000000000000000000000000000000000000000000000000000000000000000000FC000000000000000000000000000000000000000000000000000000000000000000000000000000FC000000000000000000000000000000000000000000000000000000000000000000000000000000FC000000000000000000000000000000000000000000000000000000000000000000000000000000FC00000000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFFF000000000000000000000000000000000000000000000000000000000000000000007FFFE0000FFFFC0000000000000000000000000000000000000000000000000000000000000000007FFFE0000FFFFC0000000000000000000000000000000000000000000000000000000000000000007FFFE0000FFFFC0000000000000000000000000000000000000000000000000000000000000000007FFFE0000FFFFC0000000000000000000000000000000000000000000000000000000000000000007FFFE0000FFFFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC0000000001FFFFFC0000000001F8007FF00003FFC000000000007FFFC00000001FFE000000003FFC0000000001FFFFFC0000000001F8007FF00003FFC000000000007FFFC00000001FFE000000003FFC0000000001FFFFFC0000000001F8007FF00003FFC000000000007FFFC00000001FFE000000003FFC0000000001FFFFFC0000000001F8007FF00003FFC000000000007FFFC00000001FFE000000003FFC0000000001FFFFFC0000000001F8007FF80003FFC00000000000FFFFC00000001FFE000000000000000000007FFFFFFFFFC000007FFFFFFFFFFFFFFFFF00000007FFFFFFFFFC00001FFE000000000000000000007FFFFFFFFFC000007FFFFFFFFFFFFFFFFF00000007FFFFFFFFFC00001FFE000000000000000000007FFFFFFFFFC000007FFFFFFFFFFFFFFFFF00000007FFFFFFFFFC00001FFE000000000000000000007FFFFFFFFFC000007FFFFFFFFFFFFFFFFF00000007FFFFFFFFFC00001FFE000000000000000000007FFFFFFFFFC000007FFFFFFFFFFFFFFFFF00000007FFFFFFFFFC00001FFE0000000000000000001FFFF800FFFFC000007FFFFF81FFFF03FFFF000001FFFF80003FFC00001FFE0000000000000000001FFFF800FFFFC000007FFFFF81FFFF03FFFF000001FFFF80003FFC00001FFE0000000000000000001FFFF800FFFFC000007FFFFF81FFFF03FFFF000001FFFF80003FFC00001FFE0000000000000000001FFFF800FFFFC000007FFFFF81FFFF03FFFF000001FFFF80003FFC00001FFE00007FFFFFF80000001FFE100043FFDE00007FFFE101FFFF021FFF00007FFFE100003FFDE0001FFE0000FFFFFFFC0000001FFE000003FFFF00007FFFE001FFFF000FFF00007FFFE000003FFFF0001FFE0000FFFFFFFC0000001FFE000003FFFF00007FFFE001FFFF000FFF00007FFFE000003FFFF0001FFE0000FFFFFFFC0000001FFE000003FFFF00007FFFE001FFFF000FFF00007FFFE000003FFFF0001FFE0000FFFFFFFC0000001FFE000003FFFF00007FFFE001FFFF000FFF00007FFFE000003FFFF0001FFE0000FFFFFFFC0000000000000003FFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE0000FFFFFFFC0000000000000003FFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE0000FFFFFFFC0000000000000003FFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE0000FFFFFFFC0000000000000003FFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE0000FFFFFFFC0000000000000003FFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE000000003FFC000000007FFFFFFFFFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE000000003FFC000000007FFFFFFFFFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE000000003FFC000000007FFFFFFFFFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE000000003FFC000000007FFFFFFFFFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFE000000003FFC000000007FFFFFFFFFFF00007FF80001FFC0000FFF00007FFFFFFFFFFFFFF0001FFFF80000003FFC0000001FFFFFFF03FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC0000001FFFFFFF03FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC0000001FFFFFFF03FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC0000001FFFFFFF03FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC0000001FFFFFFF03FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC000007FFFE000003FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC000007FFFE000003FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC000007FFFE000003FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC000007FFFE000003FFFF00007FF80001FFC0000FFF00007FF8000000000000001FFFF80000003FFC000007FFFE000003FFFF00007FF80001FFC0000FFF00007FF800000000000000007FF80000003FFC000007FF80000003FFFF00007FF80001FFC0000FFF00007FFFE0000000FFF000007FF80000003FFC000007FF80000003FFFF00007FF80001FFC0000FFF00007FFFE0000000FFF000007FF80000003FFC000007FF80000003FFFF00007FF80001FFC0000FFF00007FFFE0000000FFF000007FF80000003FFC000007FF80000003FFFF00007FF80001FFC0000FFF00007FFFE0000000FFF000007FF80000003FFC000007FF80000003FFFF00007FF80001FFC0000FFF00007FFFE0000000FFF000007FFFFF000FFFFC000007FFFE0000FFFFFF00007FF80001FFC0000FFF000001FFFF80003FFFF000007FFFFF000FFFFC000007FFFE0000FFFFFF00007FF80001FFC0000FFF000001FFFF80003FFFF000007FFFFF000FFFFC000007FFFE0000FFFFFF00007FF80001FFC0000FFF000001FFFF80003FFFF000007FFFFF000FFFFC000007FFFE0000FFFFFF00007FF80001FFC0000FFF000001FFFF80003FFFF000007FFFFF000FFFFC000007FFFE0000FFFFFF00007FF80001FFC0000FFF000001FFFF80003FFFF0000001FFFFFFFFFFFC0000001FFFFFFFFFFFFF00007FF80001FFC0000FFF00000007FFFFFFFFFC00000001FFFFFFFFFFFC0000001FFFFFFFFFFFFF00007FF80001FFC0000FFF00000007FFFFFFFFFC00000001FFFFFFFFFFFC0000001FFFFFFFFFFFFF00007FF80001FFC0000FFF00000007FFFFFFFFFC00000001FFFFFFFFFFFC0000001FFFFFFFFFFFFF00007FF80001FFC0000FFF00000007FFFFFFFFFC00000001FFFFFFFFFFFC0000001FFFFFFFFFFFFF00007FF80001FFC0000FFF00000007FFFFFFFFFC00000000001FFFF03FFC000000007FFFFF000FFF00007FF80001FFC0000FFF000000001FFFFFC00000000000001FFFF03FFC000000007FFFFF000FFF00007FF80001FFC0000FFF000000001FFFFFC00000000000001FFFF03FFC000000007FFFFF000FFF00007FF80001FFC0000FFF000000001FFFFFC00000000000001FFFF03FFC000000007FFFFF000FFF00007FF80001FFC0000FFF000000001FFFFFC00000000000001FFFF03FFC000000007FFFFF000FFF00007FF80001FFC0000FFE000000001FFFFFC000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC00000000000000000000000000000000000000000000000000000000000000000000001FFFFFFFFC0000000000000000000000000000000000000000000000000000000000000000000007FFFFFFFFFFF000000000000000000000000000000000000000000000000000000000000000000007FFFFFFFFFFF000000000000000000000000000000000000000000000000000000000000000000007FFFFFFFFFFF000000000000000000000000000000000000000000000000000000000000000000007FFFFFFFFFFF000000000000000000000000000000000000000000000000000000000000000000007FFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000001FFFF800000FFFFC00000000000000000000000000000000000000000000000000000000000000001FFFF800000FFFFC00000000000000000000000000000000000000000000000000000000000000001FFFF800000FFFFC00000000000000000000000000000000000000000000000000000000000000001FFFF800000FFFFC00000000000000000000000000000000000000000000000000000000000000001FFFF800000FFFFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFFF80000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC00000000000000000000000000000000000000000000000000000000000000001FFE000000003FFC00000000000000000000000000000001FFFF00000000000007E000003FFC00001FFE000000003FFC00000000000000000000000000000001FFFF00000000000007E000003FFC00001FFE000000003FFC00000000000000000000000000000001FFFF00000000000007E000003FFC00001FFE000000003FFC00000000000000000000000000000001FFFF00000000000007E000003FFC00001FFE000000003FFC00000000000000000000000000001003FFFF8000000000000FE000003FFC00001FFE000000003FFFF00007FF800000000FFF000000001FFFFFFFFFF000000001FFFF83FFFFFC00001FFE000000003FFFF00007FF800000000FFF000000001FFFFFFFFFF000000001FFFF83FFFFFC00001FFE000000003FFFF00007FF800000000FFF000000001FFFFFFFFFF000000001FFFF83FFFFFC00001FFE000000003FFFF00007FF800000000FFF000000001FFFFFFFFFF000000001FFFF83FFFFFC00001FFE000000003FFFF00007FFFC000003FFFF00000007FFFE0000FFF000000001FFFFFFFFFF0000001FFE000000003FFFF00007FFFE000003FFFF00000007FFFE0000FFF000000001FFFFFFFFFF0000001FFE000000003FFFF00007FFFE000003FFFF00000007FFFE0000FFF000000001FFFFFFFFFF0000001FFE000000003FFFF00007FFFE000003FFFF00000007FFFE0000FFF000000001FFFFFFFFFF0000001FFE000000003FFFF00007FFFE000003FFFF00000007FFFE0000FFF000000001FFFFFFFFFF0000001FFE000000003FFFF000001FFE000003FFC0000001FFFF800000FFFFC0000001FFFFFE00000000001FFE000000003FFFF000001FFE000003FFC0000001FFFF800000FFFFC0000001FFFFFC00000000001FFE000000003FFFF000001FFE000003FFC0000001FFFF800000FFFFC0000001FFFFFC00000000001FFE000000003FFFF000001FFE000003FFC0000001FFFF800000FFFFC0000001FFFFFC00000000001FFE000000003FFFF000001FFE000003FFC0000001FFFF800000FFFFC0000001FFFFFC00000000001FFE000000003FFFF000001FFE000003FFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF000001FFE000003FFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF000001FFE000003FFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF000001FFE000003FFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF000001FFE000003FFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF00000007FF800FFFFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF00000007FF800FFFFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF00000007FF800FFFFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF00000007FF800FFFFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFFF00000007FF800FFFFC0000001FFFFFFFFFFFFFFC0000001FFFF8000000000001FFE000000003FFC000000007FF800FFF000000001FFE0000000000000000001FFFF8000000000001FFE000000003FFC000000007FF800FFF000000001FFE0000000000000000001FFFF8000000000001FFE000000003FFC000000007FF800FFF000000001FFE0000000000000000001FFFF8000000000001FFE000000003FFC000000007FF800FFF000000001FFE0000000000000000001FFFF8000000000001FFE000000003FFC000000007FF800FFF000000001FFE0000000000000000001FFFF8000000000001FFFF80000003FFC000000007FFFC0FFF000000001FFE0000000000000000001FFFF8000000000001FFFF80000003FFC000000007FFFC0FFF000000001FFE0000000000000000001FFFF8000000000001FFFF80000003FFC000000007FFFC0FFF000000001FFE0000000000000000001FFFF8000000000001FFFF80000003FFC000000007FFFC0FFF000000001FFE0000000000000000001FFFF8000000000001FFFF80000003FFC000000007FFFC0FFF000000001FFE0000000000000000001FFFF8000000000001FFFF800000FFFFC0000000001FFFFFC0000000001FFFF80000003FFC0000001FFFF8000000000001FFFF800000FFFFC0000000001FFFFFC0000000001FFFF80000003FFC0000001FFFF8000000000001FFFF800000FFFFC0000000001FFFFFC0000000001FFFF80000003FFC0000001FFFF8000000000001FFFF800000FFFFC0000000001FFFFFC0000000001FFFF80000003FFC0000001FFFF8000000000001FFFF800000FFFFC0000000001FFFFFC0000000001FFFF80000003FFC0000001FFFF800000000000007FFFE003FFFF000000000001FFFFFC000000000007FFFE0000FFFFC0000001FFFF800000000000007FFFE003FFFF000000000001FFFFFC000000000007FFFE0000FFFFC0000001FFFF800000000000007FFFE003FFFF000000000001FFFFFC000000000007FFFE0000FFFFC0000001FFFF800000000000007FFFE003FFFF000000000001FFFFFC000000000007FFFE0000FFFFC0000001FFFF800000000000007FFFE003FFFF000000000001FFFFFC000000000007FFFE0000FFFFC0000001FFFF8000000000000001FFFFFFFFFF000000000001FFFFFC0000000000001FFFFFFFFFF000000001FFFF8000000000000001FFFFFFFFFF000000000001FFFFFC0000000000001FFFFFFFFFF000000001FFFF8000000000000001FFFFFFFFFF000000000001FFFFFC0000000000001FFFFFFFFFF000000001FFFF8000000000000001FFFFFFFFFF000000000001FFFFFC0000000000001FFFFFFFFFF000000001FFFF8000000000000001FFFFFFFFFF000000000001FFFFFC0000000000001FFFFFFFFFF000000001FFFF000000000000000007FFFFF00000000000000007FF00000000000000007FFFFF00000000000007E0000000000000000007FFFFF00000000000000007FF00000000000000007FFFFF00000000000007E0000000000000000007FFFFF00000000000000007FF00000000000000007FFFFF00000000000007E0000000000000000007FFFFF00000000000000007FF00000000000000007FFFFF00000000000007E0000000000000000007FFFFF00000000000000007FF00000000000000007FFFFF00000000000007C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;
            end
        else 
        if(vga_en)
        begin
            if (selection[10])
                vgaData <= notBegindata;
            else if (selection[9])
                vgaData <= fireManWindata;
            else if (selection[8])
                vgaData <= ironManWindata;
            else if (selection[7])
                vgaData <= fireMandata;
            else if (selection[6])
                vgaData <= exitdata;
            else if (selection[3] && selection[5])
                vgaData <= clouddata | ironMandata;
            else if (selection[3])
                vgaData <= clouddata;
            else if (selection[2]) 
                vgaData <= firedata;
            else if ((selection[0] || selection[1])) 
                vgaData <= enemydata;
            else if (selection[4])
                vgaData <= walldata;
            else if (selection[5])
                vgaData <= ironMandata;
            else 
                vgaData <= 12'hFFF;
        end
    end
    
    cloud m1(.clka(clk_mem),.addra(addr4),.douta(clouddata),.ena(1));
    fire m2(.clka(clk_mem),.addra(addr4),.douta(firedata),.ena(1));
    thanos m3(.clka(clk_mem),.addra(addr4),.douta(enemydata),.ena(1));
    wall m4(.clka(clk_mem),.addra(addr4),.douta(walldata),.ena(1));
    endplace m6(.clka(clk_mem),.addra(addr4),.douta(exitdata),.ena(1));
    
    IronMan m5(.clka(clk_mem),.addra(addr2),.douta(ironMandata),.ena(1));
    FireMan m7(.clka(clk_mem),.addra(addr3),.douta(fireMandata),.ena(1));

    IronManWin m8(.clka(clk_mem),.addra(addr1),.douta(ironManWindata),.ena(1));
    //FireManWin m9(.clka(clk_mem),.addra(addr1),.douta(fireManWindata),.ena(1));
    NotBegin m10(.clka(clk_mem),.addra(addr1),.douta(notBegindata),.ena(1));

    wire clk_move;
    reg [2:0] count;
    reg direction; // 0 right/down  1 left/up
    assign clk_move = clkdiv[26-speed];
    always@(posedge clk_move or negedge rst_n)
    begin
        if(!rst_n) begin
            enemy1 <= {292'b0,1'b1,7'b0};
            enemy2 <= {111'b0,1'b1,188'b0};
            count <= 0;
            direction <= 0;
        end
        else begin
            if(!dead) begin
                if(count != 4 && direction == 0)
                begin
                    enemy1 <= enemy1 << 20;
                    enemy2 <= enemy2 << 1;
                    count <= (count + 1);
                end

                if(count != 4 && direction == 1)
                begin
                    enemy1 <= enemy1 >> 20;
                    enemy2 <= enemy2 >> 1;
                    count <= (count + 1);
                end
                
                if(count == 4)
                begin
                    direction = ~direction;
                    count <= 0;
                end                
            end   
        end
    end
    
    reg pre_dead;
    reg pre_win;
    always@(posedge clkdiv[20] or posedge clear or negedge rst_n )
    begin
        if(clear)
            begin
                ironManCounter <= 4'b0;
                fireManCounter <= 4'b0;
            end
        else if(!rst_n)
            begin
                pre_dead <= 1'b0;
                pre_win <= 1'b0;
            end
        else  
            begin
                if(dead && (dead != pre_dead))
                    fireManCounter <= fireManCounter+1;
                if(IsWin && (IsWin != pre_win)) 
                    ironManCounter <= ironManCounter+1;
                pre_dead <= dead;
                pre_win <= IsWin;
            end
    end  //score reset or add one score

    always @(posedge clkdiv[19] or negedge rst_n)  //keyboard controls IronMan and FireMan's moving
    begin
        if(!rst_n)
            begin
                x1 <= 12'b0;
                y1 <= 12'b0; //IronMan`s top left corner is set to be on the top left corner of the map initially
                fx1 <= 12'd611;
                fy1 <= 12'b0; //FireMan`s top left corner is set to be on the top right corner of the map initially
            end
        else
        begin
            if(!dead && !IsWin)begin
                if(key_status[0]) // W
                begin 
                    if(y1  > 1 && !wall[( x1 >> 5 ) + ( (y1 - 1) >> 5) * 20] && !wall[( x2 >> 5 ) + ( (y1 - 1) >> 5) * 20]) 
                        y1 <= y1 - 1;
                    else
                        y1 <= y1;
                    // else if(!wall[blockNum3] && !cloud[blockNum3]&&!wall[blockNum4] && !cloud[blockNum4])
                    //     y1 <= y1 + 2;
                end 
                if(key_status[1]) // S
                begin 
                    if(y2 < height - 1 && !wall[( x1 >> 5 ) + ((y2 + 1) >> 5) * 20] && !wall[( x2 >> 5 ) + ((y2 + 1) >> 5) * 20])
                        y1 <= y1 + 1;
                    else
                        y1 <= y1;
                    // if(!wall[blockNum1] && !cloud[blockNum1]&&!wall[blockNum2] && !cloud[blockNum2])
                    //     y1 <= y1 - 2;
                end
                if(key_status[2]) // A
                begin 
                    if(x1 > 1 && !wall[((x1 - 1) >> 5 ) + (y1 >> 5) * 20] && !wall[((x1 - 1) >> 5 ) + (y2 >> 5) * 20])
                        x1 <= x1 - 1;
                    else
                        x1 <= x1;
                    // if(!wall[blockNum2] && !cloud[blockNum2]&&!wall[blockNum4] && !cloud[blockNum4])
                    //     x1 <= x1 + 2;
                end
                if(key_status[3]) // D
                begin 
                    if(x2 < width - 1 && !wall[((x2 + 1) >> 5 ) + (y1 >> 5) * 20] && !wall[((x2 + 1) >> 5 ) + (y2 >> 5) * 20]) 
                        x1 <= x1 + 1; 
                    else
                        x1 <= x1;
                    // if(!wall[blockNum1] && !cloud[blockNum1]&&!wall[blockNum3] && !cloud[blockNum3])
                    //     x1 <= x1 - 2;
                end
                if(key_status[4]) // UP
                begin 
                    if(fy1  > 1 && !wall[(fx1 >> 5 ) + ((fy1 - 1) >> 5) * 20] && !wall[( fx2 >> 5 ) + ((fy1 - 1) >> 5) * 20] 
                                && !cloud[(fx1 >> 5 ) + ((fy1 - 1) >> 5) * 20] && !cloud[( fx2 >> 5 ) + ((fy1 - 1) >> 5) * 20])
                        fy1 <= fy1 - 1;
                    // if(!wall[fblockNum3] && !cloud[fblockNum3]&&!wall[fblockNum4] && !cloud[fblockNum4])
                    //     fy1 <= fy1 + 2;
                end
                if(key_status[5]) // DWON
                begin 
                    if(fy2 < height - 1 && !wall[(fx1 >> 5 ) + ((fy2 + 1) >> 5) * 20] && !wall[(fx2 >> 5 ) + ((fy2 + 1) >> 5) * 20] 
                                        && !cloud[(fx1 >> 5 ) + ((fy2 + 1) >> 5) * 20] && !cloud[(fx2 >> 5 ) + ((fy2 + 1) >> 5) * 20])
                        fy1 <= fy1 + 1;
                    // if(!wall[fblockNum1] && !cloud[fblockNum1]&&!wall[fblockNum2] && !cloud[fblockNum2])
                    //     fy1 <= fy1 - 2;
                end
                if(key_status[6]) // LEFT
                begin 
                    if(fx1 > 1  && !wall[((fx1 - 1) >> 5 ) + (fy1 >> 5) * 20] && !wall[( (fx1 - 1) >> 5 ) + (fy2 >> 5) * 20] 
                                && !cloud[((fx1 - 1) >> 5 ) + (fy1 >> 5) * 20] && !cloud[( (fx1 - 1) >> 5 ) + (fy2 >> 5) * 20])
                        fx1 <= fx1 - 1; 
                    // if(!wall[fblockNum2] && !cloud[fblockNum2]&&!wall[fblockNum4] && !cloud[fblockNum4])
                    //     fx1 <= fx1 + 2;
                end
                if(key_status[7]) // RIGHT
                begin 
                    if(fx2 < width - 1  && !wall[((fx2 + 1) >> 5 ) + (fy1 >> 5) * 20] && !wall[((fx2 + 1) >> 5 ) + (fy2 >> 5) * 20] 
                                        && !cloud[((fx2 + 1) >> 5 ) + (fy1 >> 5) * 20] && !cloud[((fx2 + 1) >> 5 ) + (fy2 >> 5) * 20])
                        fx1 <= fx1 + 1; 
                    // if(!wall[fblockNum1] && !cloud[fblockNum1]&&!wall[fblockNum3] && !cloud[fblockNum3])
                    //     fx1 <= fx1 - 2;
                end                
            end     
        end
    end
    assign status = dead;
endmodule